<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="utf-8">
    <title>Przekształcenia morfologiczne, kontekstowe i rozmyte</title>
    <meta name="robots" content="index,follow"/> 
    <meta name="revisit-after" content="1 days"/>        
    <meta name="viewport" content="width=device-width, initial-scale=1" >
    <meta name="HandheldFriendly" content="True"/>
    <meta name="MobileOptimized" content="320"/>
    <meta name="description" content="Przekształcenia morfologiczne, kontekstowe i rozmyte"/>
    <meta name="keywords" content="grafika komputerowa, przekształcenia obrazu, przekształcenia morfologiczne, przekształcenia kontekstowe, przekształcenia rozmyte, logika rozmyta, translacja, erozja, dylacja, otwarcie, zamknięcie, black top hat, white top hat, gradient morfologiczny, filtr medianowy"/>
    <meta name="author" content="Maciej Lew"/>
    <link rel="stylesheet" href="/assets/css/base.css" type='text/css'>
    <link href="http://lion.net.pl/blog/feed.xml" type="application/atom+xml" rel="alternate" title="LionNet blog posts (atom)" />
</head>
<body>

    <nav id="topnav">
        <div>
            <img src="/assets/img/lion.net.pl.svg" width="64px" height="64px">
            <ul>
                <li>
                    <a href="/" rel="index author">O mnie</a>
                </li>
                <li>
                    <a href="/umiejetnosci/" rel="author">Umiejętności</a>
                </li>
                <li>
                    <a href="/blog/">Blog informatyczny</a>
                </li>
                <li>
                    <a href="/mapa/">Mapa strony</a>
                </li>
            </ul>
        </div>
    </nav>

    <section id="content">

        <section id="headline">
            <header>
                <h1>Programowanie, sieci komputerowe, informatyka.</h1>
            </header>
        </section>

        <section id="body">

            <div>
<article class="blog_module module">
    <h2>Przekształcenia morfologiczne, kontekstowe i rozmyte</h2>
    <hr>

    <p>Post ten jest pierwszym z trzech w cyklu związanym z tematem <strong>badania wpływu
wstępnej filtracji obrazu na wyniki segmentacji wododziałowej</strong>. Temat ten powinien
zainteresować wszystkie osoby rozpoczynające swoją przygodę z grafiką komputerową
i analizą obrazu.</p>

<p>W pierwszej części postaram się przybliżyć pojęcia związane z podstawowymi
przekształceniami jakie można wykonać na obrazie. W drugiej części omówiona 
zostanie segmentacja wododziałowa. Kolejny wpis będzie dotyczył narzędzia jakie 
napisałem w celu przeprowadzania badań wpływu wstępnych przekształceń na wyniki 
segmentacji wododziałową. Tematem ostatniego wpisu w tym cyklu będą natomiast 
same wyniki, które udało się uzyskać podczas badania obrazów RTG szczęki człowieka.</p>

<p>Zacznijmy od teorii.</p>

<h3 id="przekszta%C5%82cenia-obrazu">Przekształcenia obrazu</h3>

<h4 id="przekszta%C5%82cenia-punktowe">Przekształcenia punktowe</h4>

<p><strong>Wyrównanie histogramu</strong> jest to przykład przekształcenia punktowego obrazu w wyniku 
którego otrzymuje się obraz, w którym wszystkie poziomy szarości są równomiernie 
wykorzystane. Wyjściowy obraz charakteryzuje się lepszym kontrastem. Jeśli 
prawdopodobieństwo wystąpienia poziomu szarości wynosi:</p>

<p>$$ p(r_k)=\frac{n_k}{n} $$</p>

<p>gdzie: $$r_k$$ -- poziom szarości k, $$n_k$$ -- liczba pikseli w obrazie 
wejściowym, których wartość wynosi $$r_k$$, $$n$$ -- liczba wszystkich pikseli 
w obrazie, to wzór na wyrównanie histogramu przedstawia się następująco:</p>

<p>$$ s_k = \sum_{0&lt;j&lt;k}p(r_j) = \sum_{0&lt;j&lt;k}\frac{n_j}{n} $$</p>

<p>gdzie: $$s_k$$ -- poziom szarości w obrazie wyjściowym, $$k = 0,\ldots,L-1$$, 
L -- liczba odcieni szarości w obrazie wejściowym[<a href="#wyklady-gkiro">1</a>].</p>

<h4 id="przekszta%C5%82cenia-morfologiczne">Przekształcenia morfologiczne</h4>

<p>Przekształcenia morfologiczne polegają na wykonywaniu podstawowych przekształceń 
zbiorów, takich jak suma, różnica, dopełnienie i translacja, na elementach zbioru 
jakim jest obraz - na pikselach. W przekształceniach morfologicznych często 
stosuje się element strukturujący - niewielki, specjalnie przygotowany zbiór 
wartości będący argumentem funkcji przekształcenia morfologicznego
[<a href="#segm-obr-cyfr">2</a>,<a href="#wyklady-gkiro">1</a>].</p>

<h4 id="translacja">Translacja</h4>

<p>Translacja zbioru $$A$$ przez wektor $$b$$ oznacza że każdy element zbioru $$A$$ 
jest przesunięty w swojej dziedzinie zgodnie ze wzorem
[<a href="#segm-obr-cyfr">2</a>,<a href="#wyklady-gkiro">1</a>]:</p>

<p>$$ A+b = &#123;(a+h)|a \in A&#125; $$</p>

<h4 id="erozja">Erozja</h4>

<p>Erozja obrazu $$A$$ elementem strukturującym $$B$$ oznacza iloczyn translacji 
$$A$$ poszczególnymi elementami zbioru $$B$$
[<a href="#segm-obr-cyfr">2</a>,<a href="#wyklady-gkiro">1</a>]:</p>

<p>$$ E(A,B) = \bigcap_{b \in B}(A-b) $$</p>

<h4 id="dylacja">Dylacja</h4>

<p>Dylacja obrazu $$A$$ elementem strukturującym $$B$$ oznacza sumę translacji $$A$$
poszczególnymi elementami zbioru $$B$$[<a href="#segm-obr-cyfr">2</a>,<a href="#wyklady-gkiro">1</a>]:</p>

<p>$$ D(A,B) = \bigcup_{b \in B}(A+b) $$</p>

<h4 id="otwarcie">Otwarcie</h4>

<p>Otwarcie obrazu $$A$$ elementem strukturującym $$B$$ jest złożeniem erozji oraz 
dylacji[<a href="#segm-obr-cyfr">2</a>,<a href="#wyklady-gkiro">1</a>]:</p>

<p>$$ O(A,B) = D(E(A,B),B) $$</p>

<h4 id="zamkni%C4%99cie">Zamknięcie</h4>

<p>Zamknięcie obrazu $$A$$ elementem strukturującym $$B$$ jest złożeniem dylacji 
oraz erozji[<a href="#segm-obr-cyfr">2</a>,<a href="#wyklady-gkiro">1</a>]:</p>

<p>$$ C(A,B) = E(D(A,B),B) $$</p>

<h4 id="white-top-hat">White Top Hat</h4>

<p>Transformata White Top Hat oznacza różnicę obrazu wejściowego $$A$$ i jego 
otwarcia elementem strukturującym $$B$$[<a href="#segm-obr-cyfr">2</a>,<a href="#wyklady-gkiro">1</a>]:</p>

<p>$$ WTH(A,B) = A-O(A,B) $$</p>

<h4 id="black-top-hat">Black Top Hat</h4>

<p>Transformata Black Top Hat oznacza różnicę zamknięcia obrazu $$A$$ elementem 
strukturującym $$B$$ i obrazu wejściowego $$A$$
[<a href="#segm-obr-cyfr">2</a>,<a href="#wyklady-gkiro">1</a>]:</p>

<p>$$ BTH(A,B) = C(A,B)-A $$</p>

<h4 id="gradient-morfologiczny">Gradient morfologiczny</h4>

<p>Gradient morfologiczny oznacza różnicę pomiędzy dylacją obrazu $$A$$ elementem 
strukturującym $$B$$ a erozją tego samego obrazu tym samym elementem 
strukturującym[<a href="#segm-obr-cyfr">2</a>,<a href="#wyklady-gkiro">1</a>]:</p>

<p>$$ G(A,B) = D(A,B)-E(A,B) $$</p>

<h3 id="przekszta%C5%82cenia-kontekstowe">Przekształcenia kontekstowe</h3>

<h4 id="filtr-medianowy">Filtr medianowy</h4>

<p>Przekształcenie nazywane filtrem medianowym polega na przypisaniu pikselowi 
znajdującemu się pośrodku okna wartości będącej medianą wartości pikseli 
znajdujących się w danym oknie. Filtry medianowe pozwalają na usunięcie z obrazów 
szumów, zwłaszcza szumów typu "pieprz i sól", przy czym nie wpływają znacząco na 
kontury obiektów znajdujących się na obrazie. Okna stosowane w filtrach 
medianowych mają kształt kwadratów o środku znajdującym się na współrzędnych 
aktualnie rozpatrywanego piksela[<a href="#wyklady-gkiro">1</a>].</p>

<h3 id="przekszta%C5%82cenia-wykorzystuj%C4%85ce-elementy-logiki-rozmytej">Przekształcenia wykorzystujące elementy logiki rozmytej</h3>

<h4 id="zbiory-rozmyte">Zbiory rozmyte</h4>

<p>Logika rozmyta jest produktem teorii zbiorów rozmytych. W teorii zbiorów 
rozmytych, w przeciwieństwie do klasycznej teorii zbiorów, przynależność 
elementu do zbioru nie jest opisana przy pomocy zbioru dwóch wartości &#123;0, 1&#125;, 
lecz jako wartość z przedziału [0, 1]. Dzięki temu możliwe jest takie 
przedstawianie podzbiorów wszystkich możliwych wartości rozpatrywanych zbiorów 
na jakie wskazywałaby baza zebranej wiedzy. Wartości z przedziału [0, 1], 
przypisywane poszczególnym elementom zbiorów rozmytych noszą nazwę stopni 
przynależności danego elementu do zbioru[<a href="#ster-rozm">3</a>].</p>

<h4 id="zmienne-lingwistyczne">Zmienne lingwistyczne</h4>

<p>W teorii zbiorów rozmytych występują zbiory określane poprzez zmienne lingwistyczne:</p>

<blockquote>
  <p>Przez <em>zmienną lingwistyczną</em> rozumiemy zmienną, której wartościami są słowa 
  lub zdania w języku naturalnym lub sztucznym. Dla przykładu <em>Wiek</em> jest zmienną 
  lingwistyczną, jeśli jej wartości są wyrażone słowami, a nie liczbami, to znaczy 
  <em>młody</em>, <em>niemłody</em>, <em>bardzo młody</em>, <em>całkiem młody</em>, <em>stary</em>, <em>nie bardzo stary</em>, 
  <em>nie bardzo młody</em> itd. zamiast 20, 21, 22, 23, ...[<a href="#ster-rozm">3</a>]</p>
</blockquote>

<figure>
    <img src="/assets/img/gkiro/podobienstwo_pikseli_fuzzy.png" 
        alt="Zbiory rozmyte - podobieństwo pikseli, przykład rysunek poglądowy">
    <figcaption>
        Rysunek 1: Zbiory rozmyte - podobieństwo pikseli, przykład rysunek poglądowy
    </figcaption>
</figure>

<p>Dzięki zastosowaniu zmiennych lingwistycznych o wiele łatwiejsze stało się takie 
opisywanie badanych wielkości, by utworzone przedziały odzwierciedlały wiedzę 
ekspertów w danej dziedzinie. Zastosowanie zbiorów rozmytych, połączone z 
tworzeniem bazy wiedzy eksperckiej, pozwoliło na o wiele łatwiejsze, a dzięki 
temu szybsze, rozwiązanie wielu problemów z dziedziny automatyki i elektroniki. 
Algorytmy wykorzystujące zbiory rozmyte wykorzystywane są w sterowaniu procesami 
wytwórczymi, sterowaniu powszechnie używanymi urządzeniami elektronicznymi oraz 
w innych dziedzinach. Algorytmy te zostały wykorzystane w wielu dziedzinach 
informatyki, w tym także w grafice komputerowej. W przypadku obrazu, 
rozpatrywanym zagadnieniem może być np. podobieństwo pikseli, a utworzonymi 
zmiennymi lingwistycznymi oceny jakie można temu podobieństwu przypisać, np. 
<em>bardzo małe</em>, <em>małe</em>, <em>średnie</em>, <em>duże</em>, <em>bardzo duże</em>. Przykład takich zbiorów 
rozmytych, przedstawiony w formie wykresy pokazano na rysunku 1. Widać na nim, 
że zbiory nie są ostre, istnieją takie wartości różnicy intensywności pikseli, 
dla których przynależność do danego zbioru zawiera się w przedziale [0, 1]. Co 
więcej istnieją takie wartości różnicy intensywności pikseli, dla których 
wartość ta zawiera się w dwóch (w tym przypadku), ogólnie w więcej niż jednym 
zbiorze. Odzwierciedla to sytuację, w której ekspert dziedziny nie może 
jednoznacznie wskazać do jakiego zbiory przyporządkować zadany element
[<a href="#ster-rozm">3</a>].</p>

<h4 id="regu%C5%82y-decyzyjne">Reguły decyzyjne</h4>

<p>Do opisu związków pomiędzy zbiorami wprowadzono wyrażenia warunkowe w postaci:</p>

<p>$$ jeżeli \langle\ poprzednik&#95;reguly\ \rangle\ to \langle\ nastepnik&#95;reguly\ \rangle $$</p>

<p>Każde takie wyrażenie nazywane jest regułą decyzyjną, lub w skrócie regułą[<a href="#ster-rozm">3</a>].</p>

<h4 id="filtr-redukuj%C4%85cy-szum-wykorzystuj%C4%85cy-elementy-logiki-rozmytej">Filtr redukujący szum wykorzystujący elementy logiki rozmytej</h4>

<p>W artykule [<a href="#fuzzy-noise-reduction">4</a>] zaproponowano algorytm służący do 
redukcji szumu na obrazach, wykorzystujący technikę rozmytą. Działanie algorytmu 
dzieli się na dwie części. Podczas pierwszej z nich, dla każdego piksela obrazu 
określane jest czy jest on pikselem będącym szumem i w jakim stopniu można to 
określić, etap ten nazwano <em>Fuzzy Noise Estimation</em>. Określenie czy piksel 
zawiera szum następuje po obliczeniu dwóch parametrów rozmytych. Pierwszy z nich 
to różnica w intensywności koloru pomiędzy danym pikselem a pikselami w jego 
8-sąsiedztwie, dalej oznaczana jako <em>deg</em>:</p>

<p>$$ dif = min|f(x, y)-f(x', y')| $$</p>

<figure>
    <img src="/assets/img/gkiro/fuzzy/fuzzy_dif_chart.png" 
        alt="Wykres stopnia przynależności parametru dif">
    <figcaption>
        Rysunek 2: Wykres stopnia przynależności parametru <em>dif</em>. 
        Reprodukcja z <a href="#fuzzy-noise-reduction">4</a>.
    </figcaption>
</figure>

<p>Pierwszy parametr może przyjmować następujące wartości lingwistyczne: <em>Low</em>, 
<em>Medium</em>, <em>High</em>. Wykres stopni przynależności pokazano na rysunku 2.</p>

<p>Drugi parametr to liczba pikseli podobnych do danego piksela w jego 8-sąsiedztwie, 
dalej oznaczany jako <em>num</em>. Podobieństwo określa się na podstawie różnicy 
intensywności koloru i progu, poniżej którego ta różnica oznacza podobieństwo, 
a powyżej którego niepodobieństwo dwóch pikseli:</p>

<p>$$ num = &#123; (x', y')|(x', y') \in N_8 (x, y) \&amp; |f(x, y) - f (x', y')| &lt; treshold &#125; $$</p>

<figure>
    <img src="/assets/img/gkiro/fuzzy/fuzzy_num_chart.png" 
        alt="Wykres stopnia przynależności parametru num">
    <figcaption>
        Rysunek 3: Wykres stopnia przynależności parametru <em>num</em>. 
        Reprodukcja z <a href="#fuzzy-noise-reduction">4</a>.
    </figcaption>
</figure>

<p>Drugi parametr może przyjmować następujące wartości lingwistyczne: <em>None</em>, <em>Few</em>, 
<em>Many</em>. Wykres stopni przynależności pokazano na rysunku 3.</p>

<p>Na podstawie przedstawionych wcześniej parametrów przygotowano następujące reguły 
decyzyjne, wyznaczające stopień w jakim dany piksel jest uznawany za piksel 
zaszumiony, danej oznaczany jako <em>deg</em>. Parametr ten może przyjmować wartości 
lingwistyczne takie jak <em>Small</em>, <em>Moderate</em>, <em>Big</em>, <em>Very Big</em>:</p>

<p><strong>jeżeli</strong> (dif jest Low) <strong>i</strong> (num jest None) <strong>to</strong> (deg jest Moderate)</p>

<p><strong>jeżeli</strong> (dif jest Low) <strong>i</strong> (num jest Few) <strong>to</strong> (deg jest Big)</p>

<p><strong>jeżeli</strong> (dif jest Low) <strong>i</strong> (num jest Many) <strong>to</strong> (deg jest Very Big)</p>

<p><strong>jeżeli</strong> (dif jest Medium) <strong>i</strong> (num jest None) <strong>to</strong> (deg jest Small)</p>

<p><strong>jeżeli</strong> (dif jest Medium) <strong>i</strong> (num jest Few) <strong>to</strong> (deg jest Moderate)</p>

<p><strong>jeżeli</strong> (dif jest Medium) <strong>i</strong> (num jest Many) <strong>to</strong> (deg jest Big)</p>

<p><strong>jeżeli</strong> (dif jest High) <strong>i</strong> (num jest None) <strong>to</strong> (deg jest Small)</p>

<p><strong>jeżeli</strong> (dif jest High) <strong>i</strong> (num jest Few) <strong>to</strong> (deg jest Moderate)</p>

<p><strong>jeżeli</strong> (dif jest High) <strong>i</strong> (num jest Many) <strong>to</strong> (deg jest Moderate)</p>

<figure>
    <img src="/assets/img/gkiro/fuzzy/fuzzy_deg_chart.png" 
        alt="Wykres stopnia przynależności parametru deg">
    <figcaption>
        Rysunek 4: Wykres stopnia przynależności parametru <em>deg</em>. 
        Reprodukcja z <a href="#fuzzy-noise-reduction">4</a>.
    </figcaption>
</figure>

<p>Wykres stopni przynależności pokazano na rysunku 4.</p>

<p>Parametr <em>deg</em> jest wyjściem algorytmu <em>Fuzzy Noise Estimation</em>, a jednocześnie 
jednym z argumentów wejściowych dla algorytmu <em>Fuzzy Smoothing</em>. W drugim 
algorytmie, aby wyliczyć wagi dla wszystkich pikseli znajdujących się w 
8-sąsiedztwie obliczany jest parametr <em>diff</em>:</p>

<p>$$ diff = |f(x,y) - f(x-k, y-l)| $$</p>

<figure>
    <img src="/assets/img/gkiro/fuzzy/fuzzy_diff_chart.png" 
        alt="Wykres stopnia przynależności parametru diff">
    <figcaption>
        Rysunek 5: Wykres stopnia przynależności parametru <em>diff</em>. 
        Reprodukcja z <a href="#fuzzy-noise-reduction">4</a>.
    </figcaption>
</figure>

<p>Wykres stopni przynależności pokazano na rysunku 5. Jeśli wynik działania jest 
<em>duży</em> to <em>mała</em> waga powinna zostać przypisana do danego piksela, by zredukować 
jego udział w procesie uśredniania.</p>

<p>Na podstawie otrzymanych wartości rozmytych <em>diff</em> oraz wyjścia poprzedniego 
algorytmu <em>deg</em> utworzono następujące reguły decyzyjne wyznaczające parametr 
<em>weight</em> będący zbiorem rozmytym w którym znajduje się szukana wartość wagi dla 
danego piksela:</p>

<p><strong>jeżeli</strong> (diff jest Small) <strong>i</strong> (deg jest Low) <strong>to</strong> (weight jest Small)</p>

<p><strong>jeżeli</strong> (diff jest Small) <strong>i</strong> (deg jest Moderate) <strong>to</strong> (weight jest Moderate)</p>

<p><strong>jeżeli</strong> (diff jest Small) <strong>i</strong> (deg jest Big) <strong>to</strong> (weight jest Big)</p>

<p><strong>jeżeli</strong> (diff jest Small) <strong>i</strong> (deg jest Very Big) <strong>to</strong> (weight jest Very Big)</p>

<p><strong>jeżeli</strong> (diff jest Medium) <strong>i</strong> (deg jest Low) <strong>to</strong> (weight jest Small)</p>

<p><strong>jeżeli</strong> (diff jest Medium) <strong>i</strong> (deg jest Moderate) <strong>to</strong> (weight jest Moderate)</p>

<p><strong>jeżeli</strong> (diff jest Medium) <strong>i</strong> (deg jest Big) <strong>to</strong> (weight jest Big)</p>

<p><strong>jeżeli</strong> (diff jest Medium) <strong>i</strong> (deg jest Very Big) <strong>to</strong> (weight jest Very Big)</p>

<p><strong>jeżeli</strong> (diff jest Large) <strong>i</strong> (deg jest Low) <strong>to</strong> (weight jest Small)</p>

<p><strong>jeżeli</strong> (diff jest Large) <strong>i</strong> (deg jest Moderate) <strong>to</strong> (weight jest Moderate)</p>

<p><strong>jeżeli</strong> (diff jest Large) <strong>i</strong> (deg jest Big) <strong>to</strong> (weight jest Big)</p>

<p><strong>jeżeli</strong> (diff jest Large) <strong>i</strong> (deg jest Very Big) <strong>to</strong> (weight jest Very Big)</p>

<figure>
    <img src="/assets/img/gkiro/fuzzy/fuzzy_weight_chart.png" 
        alt="Wykres stopnia przynależności parametru weight">
    <figcaption>
        Rysunek 6: Wykres stopnia przynależności parametru <em>weight</em>. 
        Reprodukcja z <a href="#fuzzy-noise-reduction">4</a>.
    </figcaption>
</figure>

<p>Wykres stopni przynależności pokazano na rysunku 6. Na podstawie otrzymanych w 
algorytmie <em>Fuzzy Smoothing</em> wartości dobiera się wagi dla pikseli znajdujących 
się w oknie 3x3 i oblicza nową wartość dla dla piksela centralnego.</p>

<h2 id="literatura">Literatura</h2>

<ol>
<li><a name="wyklady-gkiro">
    <strong>A. Świtoński. <em>Wykłady z przedmiotu Grafika Komputerowa i 
    Rozpoznawanie Obrazów</em>.</strong> Politechnika Śląska, 2013
</a></li>
<li><a name="segm-obr-cyfr"><strong>M. Nieniewski. <em>Segmentacja obrazów cyfrowych. Metody segmentacji wododziałowej</em>.</strong> Akademicka Oficyna Wydawnicza EXIT, 2005</a></li>
<li><a name="ster-rozm"><strong>D. Driankov, H. Hellendoorm, M. Reinfrank. <em>Wprowadzenie do sterowania rozmytego</em>.</strong> Wydawnictwa Naukowo-Techniczne, 1993</a></li>
<li><a name="fuzzy-noise-reduction"><strong>H. V. Nejad, H. R. Pourreza, H. Ebrahimi. <em>A Novel Fuzzy Technique for Image Noise Reduction</em>.</strong> World Academy Of Science, Engineering and Technology, 2008</a></li>
</ol>

<hr />

<p>Treść tego wpisu zawiera fragmenty mojej pracy dyplomowej <strong>"Badanie wpływu 
wstępnej filtracji na proces segmentacji w analizie patologicznych zmian w 
obrębie zębów widocznych na zdjęciach RTG"</strong>.</p>

<hr />

<p>Zobacz także:</p>

<ul>
<li><a href="/2016/07/24/emgucvdemo-aplikacja-testujaca-wplyw-wybranych-filtrow-na-wyniki-segmentacji-wododzialowej.html">EmguCVDemo - aplikacja testująca wpływ wybranych filtrów na wyniki segmentacji wododziałowej</a></li>
<li><a href="/2016/08/06/wplyw-wstepnej-filtracji-na-segmentacje-wododzialowa.html">Wpływ wstępnej filtracji na segmentację wododziałową</a></li>
</ul>


</article>


</div>

        </section>

    </section>

    <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script></body>
</html>
