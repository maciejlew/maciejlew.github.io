<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="utf-8">
    <title>I18N z angular-gettext</title>
    <meta name="robots" content="index,follow"/> 
    <meta name="revisit-after" content="1 days"/>        
    <meta name="viewport" content="width=device-width, initial-scale=1" >
    <meta name="HandheldFriendly" content="True"/>
    <meta name="MobileOptimized" content="320"/>
    <meta name="description" content="Jak łatwo i przyjemnie przetłumaczyć aplikację napisaną w AngularJS"/>
    <meta name="keywords" content="daj się poznać 2016, konkurs programistyczny, aplikacja konkursowa, drug dose framework, aplikacja mobilna, pas pediatryczny, dawkowanie leków, ionic framework, i18n, l10n, internacjonalizacja, angular-gettext, angularjs"/>
    <meta name="author" content="Maciej Lew"/>
    <link rel="stylesheet" href="/assets/css/base.css" type='text/css'>
    <link href="http://lion.net.pl/blog/feed.xml" type="application/atom+xml" rel="alternate" title="LionNet blog posts (atom)" />

    <script type="text/javascript">
      var _paq = _paq || [];
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="//interpc.pl/~mlewinterpc/piwik/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', '1']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>

</head>
<body>

    <nav id="topnav">
        <div>
            <a href="/" rel="start index author">
                <img src="/assets/img/lion.net.pl.svg" width="64px" height="64px">
            </a>
            <ul>
                <li>
                    <a href="/" rel="start index author">LionNet</a>
                </li>
                <ul>
                    <li><a href="/lan-management-system/" rel="contents section">Lan Management System</a></li>
                </ul>
                <ul>
                    <li><a href="/drug-dose/" rel="contents section">Drug Dose</a></li>
                </ul>
            </ul>
        </div>
    </nav>

    <section id="content">

        <section id="headline">
            <header>
                <h1>I18N z angular-gettext</h1>
            </header>
        </section>

        <section id="body">

            <div>
<article class="blog_module module">

    <p>I18N aplikacji może być niemałym problemem jeśli się o niej nie pomyśli zawczasu.
W tym wpisie dowiesz się jak można przeprowadzić łatwo i przyjemnie <strong>proces 
internacjonalizacji w AngularJS</strong>.</p>

<p>Internacjonalizacja to takie przygotowanie aplikacji, aby jej późniejsze 
przystosowanie dla odbiorców posługujących się innym językiem było jak najłatwiejsze
i jak najbardziej ustandaryzowane w ramach aplikacji. Dzięki I18N możemy otworzyć 
naszą aplikację na użytkowników którzy nie posługują się jej natywnym językiem.</p>

<h3 id="biblioteka-angular-gettext">Biblioteka angular-gettext</h3>

<p><a href="https://angular-gettext.rocketeer.be/">Biblioteka angular-gettext</a> 
pozwala w łatwy sposób przystosować treść szablonów,
dyrektyw, a nawet komunikatów generowanych w kontrolerach frameworka AngularJS do
pracy w wielojęzycznym środowisku.</p>

<h4 id="instalacja-biblioteki">Instalacja biblioteki</h4>

<p>Instalacja biblioteki w projekcie polega na wydaniu kilku poleceń:</p>

<pre><code>bower install --save angular-gettext
npm install grunt-angular-gettext --save-dev
</code></pre>

<p>Po ich wydaniu mamy bibliotekę dołączoną do zależności naszego projektu. Należy 
jeszcze ją odpowiednio skonfigurować.</p>

<h4 id="konfiguracja-biblioteki-i-narz%C4%99dzi-pomocniczych">Konfiguracja biblioteki i narzędzi pomocniczych</h4>

<p>Aby dodać przygotowane przez autora biblioteki pomocnicze narzędzia do grunta 
należy, w pliku <em>Gruntfile.js</em>, wprowadzić następujące zmiany:</p>

<pre><code>grunt.loadNpmTasks('grunt-angular-gettext');
</code></pre>

<p>Powyższe polecenie zaimportuje nam zestaw wbudowanych w angular-gettext narzędzi,
które także należy skonfigurować:</p>

<pre><code>nggettext_extract: {
  pot: {
    options: {
      attributes: ['placeholder']
    },
    files: {
      'app/locale/en_UK/LC_MESSAGES/ddf.pot': ['app/partials/*.html']
    }
  },
}
</code></pre>

<p>Narzędzie <strong>nggettext_compile służy do wyszukiwania w kodzie aplikacji tekstów
do przetłumaczenia</strong>. W powyższej konfiguracji dodajemy dodatkowy atrybut HTML,
którego wartość ma być również brana pod uwagę podczas analizowania kodu (o tym 
jak oznaczać teksty do tłumaczenia a także o własnych dyrektywach przeczytasz
poniżej). Wskazujemy także lokalizację pliku POT, czyli szablonu dla wszystkich 
tłumaczeń oraz lokalizację, która ma zostać przeszukana pod kątem tekstów oznaczonych
jako do przetłumaczenia.</p>

<pre><code>nggettext_compile: {
  all: {
    files: {
      'app/scripts/translations.js': ['app/locale/**/*.po']
    }
  },
},
</code></pre>

<p>Narzędzie <strong>nggettext_extract służy do kompilacji przygotowanych plików PO z 
tłumaczeniami do kodu JS</strong>. Wskazujemy tu ścieżkę w której ma zostać utworzony 
skompilowany plik oraz ścieżkę w której znajdują się pliki z gotowymi tłumaczeniami.</p>

<p>Ponad to, należy w pliku index.html załadować bibliotekę oraz plik z tłumaczeniami,
najlepiej przed kodem samej aplikacji:</p>

<pre><code>&lt;script src="bower_components/angular-gettext/dist/angular-gettext.js"&gt;&lt;/script&gt;
&lt;script src="scripts/translations.js"&gt;&lt;/script&gt;
</code></pre>

<p>Kolejnym krokiem jest wstrzyknięcie modułu do naszej aplikacji, np:</p>

<pre><code>var dependencies = ['gettext', 'ionic', 'ui.router', 'DrugDoseFrameworkControllers'];
var app = angular.module('DrugDoseFrameworkApp', dependencies);
</code></pre>

<p>Możemy także uzależnić język aplikacji od ustawień przeglądarki klienta:</p>

<pre><code>app.run(function ($ionicPlatform, gettextCatalog) {
    switch (window.navigator.language.substr(0, 2)) {
        case 'pl':
            gettextCatalog.setCurrentLanguage('pl_PL');
            break;
        case 'de':
            gettextCatalog.setCurrentLanguage('de_DE');
            break;
    }
};
</code></pre>

<p>lub podpiąć metodę <em>setCurrentLanguage</em> pod jakiś element interfejsu umożliwiając
tym samym zmianę języka samemu użytkownikowi, wedle jego upodobań.</p>

<h4 id="przygotowanie-tekst%C3%B3w">Przygotowanie tekstów</h4>

<p>Biblioteka angular-gettext definiuje kilka sposobów w jaki możemy przygotować
teksty do tłumaczeń tak, aby mogły zostać przez nie odnalezione. Pierwszym z nich 
jest <strong>otoczenie tekstu znacznikiem \&lt;translate&#62;</strong>:</p>

<pre><code>&lt;translate&gt;sentence to translate&lt;/translate&gt;
</code></pre>

<p>Jeśli nasz tekst znajduje się już w innym znaczniku nie musimy wprowadzać kolejnego,
<strong>możemy użyć atrybutu translate</strong>:</p>

<pre><code>&lt;span translate&gt;sentence to translate&lt;/span&gt;
</code></pre>

<p>Innym pomysłem może być <strong>użycie filtru translate</strong>:</p>

<pre><code>{{ 'sentence to translate' | translate }}
</code></pre>

<p>Możemy także przygotować własną dyrektywę wspierającą tłumaczenia:</p>

<pre><code>app.directive('placeholder', ['gettextCatalog', function (gettextCatalog) {
    return {
        restrict: 'A',
        link: function (scope, element, attrs) {
            element.attr('placeholder', gettextCatalog.getString(attrs.placeholder));
        }
    };
}]);
</code></pre>

<p>Jeśli chcemy przetłumaczyć coś w kontrolerze to należy do tego wykorzystać metodę
getString, jak pokazałem w powyższym przykładzie.</p>

<p>Biblioteka angular-gettext wspiera także takie zaawansowane opcje jak: komentarze 
do tłumaczeń, kontekst tłumaczeń (rzeczownik, czasownik, itp.), tłumaczenia w 
liczbie mnogiej, interpolację zmiennych w tłumaczone teksty, lazy-loading tłumaczeń.
O tym wszystkim możesz poczytać w 
<a href="https://angular-gettext.rocketeer.be/dev-guide/">bardzo dobrej dokumentacji biblioteki</a>.</p>

<h4 id="t%C5%82umaczenie-tekst%C3%B3w">Tłumaczenie tekstów</h4>

<p>Gdy mamy już oznaczony tekst który chcemy przetłumaczyć, nadchodzi pora aby się 
za to zabrać. Na szczęście nie musimy go teraz szukać ponownie i przepisywać do
plików z tłumaczeniami. Należy wykonać komendę <strong>grunt nggettext_extract</strong>. W
lokalizacji wskazanej w konfiguracji tego narzędzia znajdziemy plik POT, a w nim 
wszystkie znalezione teksty, wraz z ich lokalizacją w projekcie. W kolejnym kroku 
należy skopiować szablon, zmieniając mu rozszerzenie na PO, do lokalizacji tłumaczeń
które chcemy obsługiwać (nazwa pliku może być dowolna), np:</p>

<ul>
<li>app

<ul>
<li>locale

<ul>
<li>en_UK</li>
<li>LC_MESSAGES

<ul>
<li>ddf.pot</li>
</ul></li>
<li>pl_PL</li>
<li>LC_MESSAGES

<ul>
<li>ddf.po</li>
</ul></li>
<li>de_DE</li>
<li>LC_MESSAGES

<ul>
<li>ddf.po</li>
</ul></li>
</ul></li>
</ul></li>
</ul>

<p>Do pliku <em>ddf.po</em> z polskimi tłumaczeniami należy skopiować zawartość szablonu POT.
Oprócz samego tłumaczenia możemy także uzupełnić nagłówki tego pliku, zgodnie z
<a href="https://www.gnu.org/software/gettext/manual/html_node/Header-Entry.html">dokumentacją formatu PO</a>.
Nie jest to wymagane, ale może pomóc przyszłym tłumaczom naszej aplikacji.</p>

<p>Gdy mamy już wszystko przetłumaczone należy skompilować to do pliku JS. Pomoże nam
w tym polecenie <strong>grunt nggettext_compile</strong>. Po jego wykonaniu w pliku <em>translations.js</em>
powinno znaleźć się coś podobnego do :</p>

<pre><code>angular.module('gettext').run(['gettextCatalog', function (gettextCatalog) {
/* jshint -W100 */
    gettextCatalog.setStrings('de_DE', {
        "Type drug name":"Schreiben Sie die Medikamentennamen",
        "calculate":"berechnen"
    });
    gettextCatalog.setStrings('pl_PL', {
        "Type drug name":"Wpisz nazwę leku",
        "calculate":"oblicz"
    });
/* jshint +W100 */
}]);
</code></pre>

<p>(linie zostały celowo zwinięte dla lepszej czytelności, normalnie wszystko jest 
zminimalizowane).</p>

<p>Od teraz tłumaczenia są dostępne dla aplikacji. Jeśli zmiana języka aplikacji 
oparta jest o <strong>window.navigator.language</strong> to możemy wszystko łatwo przetestować
zmieniając ustawienia języka w opcjach przeglądarki.</p>

<p>Opisana tu procedura została przeze mnie wdrożona w mojej konkursowej aplikacji 
DDF. Jak to zrobiłem możesz 
<a href="https://github.com/maciejlew/drug-dose-framework/commit/030e2680373f6f51471b34e085b1c687303a49f6">zobaczyć na GitHubie</a>. 
W razie problemów napisz komentarz - postaram się pomóc.</p>


</article>


</div>

        </section>

    </section>

    <nav id="footer">
        <div class="wrapper">
            <div id="project-links">
                <h6>Projekty:</h6>
                <ul>
                    <li><a href="/lan-management-system/" rel="contents section">Lan Management System</a></li>
                </ul>
                <ul>
                    <li><a href="/drug-dose/" rel="contents section">Drug Dose</a></li>
                </ul>
            </div>
            <div id="site-links">
                <h6>Zobacz także:</h6>
                <ul>
                    <li><a href="/umiejetnosci/" rel="author">O LionNet</a></li>
                    <li><a href="/blog/" rel="contents">Blog IT</a></li>
                    <li><a href="/mapa/" rel="contents">Mapa strony</a></li>
                </ul>
            </div>
            <div id="copyrights-and-disclaimer">
                <h6>Polityka:</h6>
                <p>&copy; Copyright by LionNet 2014-2018.</p>
                <p>Strona wykorzystuje pliki cookies</p>
                <p>Korzystając ze strony wyrażasz zgodę na używanie plików cookies, zgodnie z aktualnymi ustawieniami przeglądarki.</p>
                <p>Więcej informacji znajdziesz na stronie dotyczącej <a href="/polityka-plikow-cookies/" rel="license copyrights help nofollow">polityki plików cookie</a>.</p>
            </div>
        </div>
    </nav>

    </body>
</html>
